{% extends "base.html" %}

{% block title %}Wordle Archive{% endblock %}

{% block addhead %}
<script type="text/javascript">
  //<![CDATA[
  document.addEventListener("DOMContentLoaded", function() {
    var puzzles = [
      {% for puzzle in puzzles -%}
      {{ puzzle|puzzle_string|jsstring|safe }},
      {% endfor -%}
    ];
    var linkboxes = document.querySelectorAll(".puzzle-links");
    for (var i = 0; i < linkboxes.length; i++) {
      var addMiddot = document.createTextNode(" \u00B7 ");
      linkboxes[i].appendChild(addMiddot);

      var copyLink = document.createElement("a");
      copyLink.href = "javascript:void(0)";
      copyLink.textContent = "copy";
      (function (copyLink, i) {
        copyLink.addEventListener("click", function () {
          navigator.clipboard.writeText(puzzles[i]).then(function () {
            copyLink.textContent = "copied!";
          }, function () {
            copyLink.textContent = "failed! :-(";
          });
        });
      })(copyLink, i);
      linkboxes[i].appendChild(copyLink);
    }
  });
  //]]>
</script>
{% endblock %}

{% block content %}
<h1>Wordle Archive</h1>

{% if let Some(date) = date_opt %}
<h2>{{ date.format("%Y-%m-%d")|escape }}</h2>
{% endif %}

<p class="date-nav">
  {% if let Some(date) = date_opt -%}
    {% if let Some(yesterday) = date.pred_opt() -%}
      <a href="{{ yesterday.format("%Y-%m-%d")|escape }}{% if let Some(tok) = token %}?token={{ tok|urlencode|escape }}{% endif %}" title="one day back">&#11013;&#65039;</a>
    {% else -%}
      <span class="disabled-link">&#11013;&#65039;</span>
    {% endif -%}
    {% if let Some(tomorrow) = date.succ_opt() -%}
      <a href="{{ tomorrow.format("%Y-%m-%d")|escape }}{% if let Some(tok) = token %}?token={{ tok|urlencode|escape }}{% endif %}" title="one day forward">&#10145;&#65039;</a>
    {% else -%}
      <span class="disabled-link">&#10145;&#65039;</span>
    {% endif -%}
  {% endif -%}

  {% if allow_spoiling -%}
    {% if !spoil -%}
      <a href="?spoil=true{% if let Some(tok) = token %}&amp;token={{ tok|urlencode|escape }}{% endif %}" title="spoil the answers">&#128065;&#65039;</a>
    {% else -%}
      <span class="disabled-link">&#128065;&#65039;</span>
    {% endif -%}
  {% endif -%}

  <a href="../stats" title="statistics">{% if stats_upwards_curve %}&#128200;{% else %}&#128201;{% endif %}</a>
</p>

{% for puzzle in puzzles -%}
<h3>{{ puzzle.site.name|escape }}</h3>

<p class="puzzle-links"><a href="../puzzle/{{ puzzle.id }}">only this</a> &middot; <a href="{{ puzzle.site.url|escape }}">visit site</a></p>

<section class="puzzle site-{{ puzzle.site.css_class|escape }}">

<div class="head">{{ puzzle.head|escape }}</div>

{% if puzzle.site.variant == "geo" -%}
  {% for (guess, solution) in puzzle.guess_lines -%}
  <div class="field-row guess-row">
    {%- for g in guess.chars() -%}
      {%- if g == 'C' || g == 'M' || g == 'W' -%}
        <div class="field-box guess-{{ g|escape }}"></div>
      {%- else -%}
        <div class="arrow-box">{{ g|escape }}&#65039;</div>
      {%- endif -%}
    {%- endfor -%}

    {% if spoil -%}
      <div class="guess-box">{{ solution|escape }}</div>
    {% endif -%}
  </div>
  {% endfor -%}

  {% if spoil && !puzzle.victory() -%}
  <div class="field-row solution-row">
    <div class="guess-box">{{ puzzle.solution|escape }}</div>
  </div>
  {% endif -%}

{% else if puzzle.site.variant == "audio" -%}

  {% for (guess, solution) in puzzle.guess_lines -%}
  <div class="field-row guess-row">
    {%- for g in guess.chars() -%}
      <div class="field-box guess-{{ g|escape }}"></div>
    {%- endfor -%}

    {%- if spoil -%}
      <div class="guess-box">{{ solution|escape }}</div>
    {%- endif -%}
  </div>
  {% endfor -%}

  {% if spoil && !puzzle.victory() -%}
  <div class="field-row solution-row">
    <div class="guess-box">{{ puzzle.solution|escape }}</div>
  </div>
  {% endif -%}

{% else if puzzle.site.variant == "wordle32" -%}

{% let wrong_solution_manager = puzzle|make_wrong_solution_manager -%}

<div class="field">
  {% for pattern_line in puzzle.pattern_lines -%}
    <div class="field-row guess-row">
      {% for pattern_chunk in pattern_line.split(" ") -%}
        {% if pattern_chunk == "XX" -%}
          <div class="field-box guess-W">XX</div>
        {% else -%}
          <div class="field-box guess-T">{{ pattern_chunk }}</div>
        {% endif -%}
      {% endfor -%}
    </div>
    {% if spoil -%}
      <div class="solution-row">
        {% for pattern_chunk in pattern_line.split(" ") -%}
          {% if pattern_chunk != "XX" -%}
            {% if let Ok(index) = usize::from_str_radix(pattern_chunk, 10) -%}
              {% if let Some(solution) = puzzle.solution_lines|get_index(index - 1) -%}
                <div class="solution-box correct">{{ solution|escape }}</div>
              {% endif -%}
            {% endif -%}
          {% else -%}
            {% let this_index = wrong_solution_manager.advance() -%}
            {% if let Some(solution) = puzzle.solution_lines|get_index(this_index) -%}
              <div class="solution-box wrong">{{ solution|escape }}</div>
            {% endif -%}
          {% endif -%}
        {% endfor -%}
      </div>
    {% endif -%}
  {% endfor -%}

  {% if spoil -%}
    <div class="all-guess-row">
      {% for index in wrong_solution_manager.correct_indexes() -%}
        {% if let Some(guess) = puzzle.solution_lines|get_index(index) -%}
          <div class="solution-box">{{ guess|escape }}</div>
        {% endif -%}
      {% endfor -%}
    </div>
  {% endif -%}
</div>

{% else -%}

<div class="field">
{% for (guess, solution) in puzzle.guess_lines -%}
<div class="field-row guess-row">
  {%- for (g, s) in guess.chars().zip(solution.chars()) -%}
  <div class="field-box guess-{{ g|escape }}">{% if spoil %}{{ s|escape }}{% endif %}</div>
  {%- endfor -%}
</div>
{% endfor -%}

{% if spoil && !puzzle.victory() -%}
<div class="field-row solution-row">
  {%- for s in puzzle.solution.chars() -%}
  <div class="field-box solution">{{ s|escape }}</div>
  {%- endfor -%}
</div>
{% endif -%}

</div>
{% endif -%}

<div class="tail">{{ puzzle.tail|escape }}</div>

</section>

{% endfor -%}

{% endblock %}
